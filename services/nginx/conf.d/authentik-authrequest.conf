# Authentik Forward Authentication Configuration
#
# This file configures the auth_request to validate requests with Authentik
# Include this in server blocks that require authentication
#
# Usage:
#   include /etc/nginx/conf.d/authentik-authrequest.conf;
#   include /etc/nginx/conf.d/authentik-location.conf;
#

# Send authentication request to Authentik
auth_request /outpost.goauthentik.io/auth/nginx;

# Capture authentication response headers
auth_request_set $authentik_username $upstream_http_x_authentik_username;
auth_request_set $authentik_email $upstream_http_x_authentik_email;
auth_request_set $authentik_name $upstream_http_x_authentik_name;
auth_request_set $authentik_uid $upstream_http_x_authentik_uid;
auth_request_set $authentik_groups $upstream_http_x_authentik_groups;

# Capture user and email for backward compatibility
auth_request_set $authentik_user $upstream_http_x_authentik_username;

# Error handling - redirect to login on auth failure
error_page 401 = @authentik_proxy_signin;
